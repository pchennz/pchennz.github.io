function getServerUrl(a){switch(a){case"local":return"http://keento.local:8000/stubs/";case"test":return"http://keentostubs.pchennz.com/stubs/";case"stage":return"http://api.keenhub.com/";default:return"http://api.keen.to/"}}var ktGlobals={ajaxTimeout:25000,ajaxTimeoutLong:120000,THINK_TIME:1200,serverUrl:getServerUrl(KeenEnv.endpoint),picsUrl:"http://pchennz.com/projects/sencha/img/",fbAppId:"109670439189264",gcmId:"194875163463",appVersion:"1.3.4.6",WELCOME_MIN_INTERESTS:5,WELCOME_MIN_FOLLOWINGS:5,ACTIVITY_MIN_FOLLOWERS:10,STATUS_OPEN:0,STATUS_EXPIRED:1,STATUS_CANCELLED:2,VISIBILITY_NETWORK:"n",VISIBILITY_FOF:"fof",VISIBILITY_FRIENDS:"f",VISIBILITY_INVITES:"i",MESSAGE_MAX_LENGTH:120,USER_SCOPE_FOLLOWING:1,USER_SCOPE_FOLLOWER:2,USER_SCOPE_ON:3,USER_SCOPE_OFF:4,USER_SCOPE_FRIENDS:5,USER_SCOPE_FOFS:6,USER_SCOPE_WELCOME:7,RELATION_SELF:0,RELATION_FF:1,RELATION_FOLLOWING:2,RELATION_FOLLOWER:3,RELATION_FRIEND:4,RELATION_FOF:5,RELATION_INVITING:6,RELATION_OTHER:7,ACTION_FOLLOW:"f",ACTION_NOTIFY:"n",ACTION_INVITE:"i",ACTION_CONFIRM:"c",ACTION_KEEN:"k",NOTIF_ACTIVITY_NEW:"na",NOTIF_ACTIVITY_COMMENT:"c",NOTIF_ACTIVITY_KEEN:"k",NOTIF_MESSAGE:"m",LABEL_ADD:"\u271A",LABEL_REPOST:"\u2009",LABEL_INVITE:"&nbsp;",LABEL_DETAILS:"\u2022\u2009\u2022\u2009\u2022",MAX_FB_WALL_INVITE:10,MAX_FB_APPREQUEST_INVITE:50,timeDiffInWords:function(c,j,h){try{var a=Math.ceil((new Date().getTime())/1000),b,g,f;c=c||a;f=Math.abs(a-c);if(f<=60){return(c>a?"new":"a few seconds ago")}else{if(f<3600){b=Math.ceil(f/60);g=b+(j?" min":"m")}else{if(f<86400){b=Math.ceil(f/3600);g=b+(j?(" hour"+(b>1?"s":"")):"h")}else{b=Math.ceil(f/86400);g=b+(j?(" day"+(b>1?"s":"")):"d")}}}if(c>a){return"in "+g}else{return g+" ago"}}catch(d){return""}},timeInWords:function(h){var c=new Date(),e=c.getTime(),g=c.getTimezoneOffset()*60000,b=Math.ceil((e-g)/86400000)*86400000+g,d=b+86400000,f=b-86400000,a=f-86400000;if(h>a&&h<d){return Ext.Date.format(new Date(h),"g:i a")+(h<f?" yesterday":(h<b?" today":" tomorrow"))}else{return Ext.Date.format(new Date(h),"g:i a, D jS M")}},activityCardHtml:function(b,h,k){var j,m,f,g,l=b.s,d=b.t;j='<img class="pic-part" src="http://pchennz.com/projects/sencha/img/'+b.tag+'.jpg"/>';var a;m='<div class="message-part">';for(i=0,ln=b.msg.length;i<ln;i++){a=b.msg[i];if(a.charAt(0)=="#"){m+='<span class="tag-green">'+a+"</span>"}else{m+=a}}m+="</div>";var e=b.creator,c;c=(e.g?e.g+",&ensp;":"")+(e.r<=ktGlobals.RELATION_FRIEND?ktGlobals.followersHtml(e.fo):ktGlobals.mutualsHtml(e.m));f='<div class="creator-part">			<img style="background-image:url(\'http://graph.facebook.com/'+e.uid+'/picture\');" src="resources/images/img-mask50.png"/>			<div class="creator-details">				<div class="name">posted by '+e.n1+'</div>			<div class="relation">'+c+"</div>		</div></div>";if(h){g='<div class="extras-part">				<div class="time"><span class="icon-time"></span>&ensp;'+ktGlobals.timeDiffInWords(b.c,true)+'</div>				<div class="people"><span class="icon-f"></span>&ensp;'+d.kn+"</div>			</div>"}return'<div class="card-container">'+j+m+f+g+'<div class="mask"></div></div>'},activityActionsHtml:function(a){var c,b=a.s;if(b.cr){c='<div class="action invite">+ Invite</div>				<div class="action edit">Edit</div>				<div class="action share">Share</div>'}else{if(b.mt){c='<div class="action comment">Add comment</div>				<div class="action invite">Bring a friend</div>'}else{if(b.kn){c='<div class="action comment">Add comment</div>				<div class="action invite">Tell a friend</div>'}else{c=""}}}return'<div class="activity-actions-container">'+c+"</div>"},activityKeenersHtml:function(a,d,e){var h,j=a.s,b=a.t,f=null,c=null,g;if(!j.cr){f=a.creator;g=a.keeners.length;if(g==1){c=a.keeners[0]}}else{if(a.keeners.length&&e){f=a.keeners[0];g=a.keeners.length-1;if(g==1){c=a.keeners[1]}}else{h="no one else is keen yet"}}if(f){h=f.n1+" "+f.n2;if(g){h+=" and "+(c?c.n1:g+" others")}if(!j.cr){h="with "+h}else{h+=(g?" are":" is")+" keen"}}if(!e){h='<div class="activity-keeners-label"><span class="icon-f"></span>&ensp;'+h+"</div>"}return h},watchlistItemHtml:function(b){var h,l,j,f,d="",k=b.s,c=b.t;h='<img class="pic-part" src="http://pchennz.com/projects/sencha/img/'+b.tag+'.png"/>';l='<div class="message-part tag-green">#'+b.tag+"</div>";if(k.cn&&b.confirmed){j='<div class="details-part">				<div><div class="icon"><span class="icon-f green"></span></div>'+ktGlobals.activityKeenersHtml(b,true,true)+'</div>				<div><div class="icon"><span class="icon-time green"></span></div>'+(b.confirmed.when?ktGlobals.timeInWords(b.confirmed.when):"view chat")+'</div>				<div><div class="icon"><span class="icon-loc green"></span></div>'+(b.confirmed.where?b.confirmed.where:"view chat")+"</div>			</div>"}else{j='<div class="details-part">				<div class="keeners"><div class="icon"><span class="icon-f"></span></div>'+ktGlobals.activityKeenersHtml(b,false,true)+'</div>				<div class="time"><div class="icon"><span class="icon-time"></span></div>closing '+ktGlobals.timeDiffInWords(b.e,true)+"</div>			</div>"}var g="",e="",a;if(k.nt){g='<div class="label-nt">'+k.nt+"</div>";d=" nt"}else{if(k.cn){g='<div class="label-cn"><span class="icon-tick"></span>&ensp;it\'s on!</div>';d=" cn"}else{if(k.cr){g='<div class="label-cr">creator</div>';d=" cr"}}}if(k.cr){e='<div class="action"></div>';a=""}else{if(k.cn){e='<div class="action></div>';a=""}}f=(g||e)?'<div class="extras-part">'+g+e+"</div>":"";return'<div class="watchlist-container'+d+'">'+h+l+j+f+'<div class="mask"></div></div>'},keenerCardHtml:function(a){var d,b,f;d='<div class="pic-container">			<img class="pic-part" src="http://pchennz.com/projects/sencha/img/'+a.tag+'.jpg"/>			<div class="pic-mask"></div>			<div class="keener-container">				<img class="pic-keener" src="http://graph.facebook.com/'+a.uid+'/picture?width=80&height=80"/>			</div>		</div>';var e,c,g;b='<div class="message-part">			<div class="tag-maroon">'+a.n1+" "+a.n2+'</div><div class="relation">'+(a.g?a.g+",&ensp;(":"(")+(a.r<=ktGlobals.RELATION_FRIEND?"friend":ktGlobals.mutualsHtml(creator.m))+")</div>";for(c=0,g=a.msg.length;c<g;c++){e=a.msg[c];if(e.charAt(0)=="#"){b+='<span class="tag-green">'+e+"</span>"}else{b+=e}}b+="</div>";f='<div class="extras-part">			<div class="time"><span class="icon-time"></span>&ensp;'+ktGlobals.timeDiffInWords(a.c,true)+'</div>			<div class="people">				<span class="icon-star"></span>&ensp;'+ktGlobals.followersHtml(a.fo)+"</div></div>";return'<div class="card-container keener">'+d+b+f+'<div class="mask"></div></div>'},interestCardHtml:function(k){var l,o,e,j;l='<img class="pic-part" src="http://pchennz.com/projects/sencha/img/'+k.tag+'.jpg"/>';var a,f,h;o='<div class="message-part">';for(f=0,h=k.msg.length;f<h;f++){a=k.msg[f];if(a.charAt(0)=="#"){o+='<span class="tag-green">'+a+"</span>"}else{o+=a}}o+="</div>";var n=k.fr,g=(n?n.length:0),m=k.fo-g,c=k.uids,b,d;if(n&&g){b=n[0].n;if(g>1){b+=", "+n[1].n}if(m>0){b+=" and<br/>"}d='<div class="pic-container">';for(f=0;f<g;f++){d+="<img style=\"background-image:url('http://graph.facebook.com/"+n[f].uid+'/picture\');" src="resources/images/img-mask50.png"/>'}d+="</div>"}else{b="";d=""}if(m>0){b+=m+" others are always keen"}e='<div class="followers-part">'+b+d+"</div>";j='<div class="extras-part">			<div class="time"><span class="icon-time"></span>&ensp;sometime in future</div>			<div class="people">				<span class="icon-star"></span>&ensp;'+ktGlobals.followersHtml(k.fo)+"</div></div>";return'<div class="card-container interest">'+l+o+e+j+"</div>"},postSearchItemHtml:function(c,b){var e=(b%2),a=c.tag,d=c.fo;if(a){return'<div class="tag-icon'+(e?" right":"")+'" style="background-image:url(\'http://pchennz.com/projects/sencha/img/'+a+'.png\');"><div class="overlay"><div class="followers'+(d?'">'+d:' new">new')+"</div><span>#"+a+"</span></div></div>"}else{return""}},labelsContainerHtml:function(c,b){var a="";if(Keen.app.profileData.followings[c.uid]){a+='<span class="icon-label-following"></span>'}else{if(c.r<=ktGlobals.RELATION_FRIEND){a+='<span class="icon-label-friend"></span>'}}if(b&&Keen.app.profileData.interests[b]){a+='<span class="icon-label-interest"></span>'}if(a){a='<div class="labels">'+a+"</div>"}else{a='<span class="icon-mutuals"></span>'+c.m}return a},userHtml:function(a,o,e,b){var d,f,l,k,c=1,g=2,h=3,n=7,j=c;if(a.uid){d="<img style=\"background-image:url('http://graph.facebook.com/"+a.uid+'/picture\');" src="resources/images/img-mask50.png"/>'}f='<div class="name">'+(a.name?a.name:a.n1+" "+a.n2)+(o==ktGlobals.ACTION_FOLLOW?'<span class="icon-star"></span>':"")+"</div>";if(a.uid){l='<div class="detail">'+(a.g?a.g+", ":"")+(a.m?ktGlobals.mutualsHtml(a.m):ktGlobals.followersHtml(a.fo))+"</div>"}else{var m=a.p;if(m.length){l='<div class="detail light">'+m[0].value+"</div>"}}if(o!=ktGlobals.ACTION_KEEN||b){k='<div class="action"><button class="checkbox"></button></div>'}else{k=""}return'<div class="user-row-container'+(b?' selected">':(e?' tapped">':'">'))+(d?'<div class="pic-col">'+d+"</div>":"")+'<div class="info-col'+(a.uid?"":" empty")+'">'+f+(l?l:"")+k+"</div>		</div>"},navPanelHtml:function(a){if(!a){return}return'<div class="user-row-container"><div class="pic-col"><img style="background-image:url(\'http://graph.facebook.com/'+a.uid+'/picture\');" src="resources/images/img-mask50.png"/></div>			<div class="info-col"><div class="name">'+a.n1+" "+a.n2+'</div>			<div class="detail">'+(a.g?a.g+",<br/>":"")+ktGlobals.followersHtml(a.fo)+"</div>			</div>		</div>"},profileMenuHtml:function(){var a=Keen.app.profileData;return'<div class="user-row-container">			<div class="pic-col">				<img class="profile" style="background-image:url(\'http://graph.facebook.com/'+a.uid+'/picture\');" src="resources/images/profile-mask-gray2.png"/>			</div>			<div class="info-col">				<div class="name-part"><div class="left">'+a.n1+" "+a.n2+'</div><div class="right">(&thinsp;<span class="icon-star"></span> '+a.t.fo+(a.t.fo>1?" followers":" follower")+'&thinsp;)</div></div>				<div class="details-part">					<div class="left">following:</div><div class="right"><span class="tag-green">'+Object.keys(a.interests).length+'</span> interests | <span class="tag-maroon">'+Object.keys(a.followings).length+"</span> "+(Keen.app.useScarfies?"scarfies":"friends")+'</div></div>			</div></div>			<div class="actions-container">				<button class="white left">open <span class="tag-green">interests</span></button>				<button class="white right">open <span class="tag-maroon">'+(Keen.app.useScarfies?"scarfies":"friends")+"</span></button>			</div>"},interestHtml:function(b,c){var d,a,e,f;d="<img style=\"background-image:url('http://pchennz.com/projects/sencha/img/"+b.tag+'.png\');" width="50" height="50" src="resources/images/img-mask50.png"/>';a='<div class="tag">#'+b.tag+'<span class="icon-star"></span></div>';e='<div class="detail">'+ktGlobals.followersHtml(b.fo)+"</div>";f='<div class="action"><button class="checkbox"></button>';return'<div class="interest-row-container'+(c?" tapped":"")+'">			<div class="pic-col">'+d+'</div>			<div class="info-col">'+a+e+f+"</div>		</div>"},commentHtml:function(b){var e,f,a,d,c=(b.uid==Keen.app.profileData.uid);if(c){e=""}else{e="<img style=\"background-image:url('http://graph.facebook.com/"+b.uid+'/picture\');" src="resources/images/img-mask50.png"/>'}f='<div class="comment">'+b.msg+"</div>";return'<div class="comment-container'+(c?" right":"")+'">'+e+f+"</div>"},commentRowHtml:function(b){var d,e,a,c;d='<img class="profile" style="background-image:url(\'http://graph.facebook.com/'+b.uid+'/picture\');" src="resources/images/profile-mask.png"/>';e='<div class="comment-part">'+b.msg+"</div>";a='<div class="details-part">'+b.n1+" "+b.n2+"</div>";c='<div class="time-part">'+ktGlobals.timeDiffInWords(b.c)+"</div>";return'<div class="user-row-container"><div class="pic-col">'+d+'</div><div class="info-col">'+e+a+c+"</div></div>"},commentsTitleHtml:function(c,b,a){return'<div class="inner closed">			<span class="icon-comments"></span>&ensp;'+(c.cm||"no")+" comment"+(c.cm==1?"":"s")+'</div><div class="inner open">'+(b.cr?"":'<span class="icon-comments green"></span>&ensp;<span class="tag-green">#'+a+"</span>")+"</div>"},notificationHtml:function(l,e,b,g){var f,k,h,j,d,n;j="resources/images/img-mask53-msg.png";if(l.type==ktGlobals.NOTIF_ACTIVITY_CANCEL){h="resources/images/profile-cancelled.png"}else{if(l.uid){h="http://graph.facebook.com/"+l.uid+"/picture";j="resources/images/img-mask50.png"}else{if(l.tag){h=ktGlobals.picsUrl+l.tag+".png"}else{switch(l.icon){case"q":h="resources/images/profile-question.png";break;case"c":h="resources/images/profile-cancelled.png";break;case"KEEN":h="resources/images/profile-KEEN.png";break;default:h="resources/images/profile-confirmed.png"}}}}f="<img style=\"background-image:url('"+h+'\');" src="'+j+'"/>';if(e){d=e.get("creator");n=e.get("tag")}switch(l.type){case ktGlobals.NOTIF_MESSAGE:k=l.msg;break;case ktGlobals.NOTIF_FRIEND_FOLLOW:k=b.get("n1")+" "+b.get("n2")+(b.get("r")==ktGlobals.RELATION_FF?" followed you back.":" is following you.");break;case ktGlobals.NOTIF_ACTIVITY_INVITE:k=d.n1+" "+d.n2+" invited you to "+(n?'<span class="tag-green">#'+n+"</span>.":"an activity.");break;case ktGlobals.NOTIF_ACTIVITY_NEW_INTEREST:k=d.n1+" "+d.n2+" is keen for "+(n?'<span class="tag-green">#'+n+"</span>.":"an activity.");break;case ktGlobals.NOTIF_ACTIVITY_NEW_FOLLOWING:k=d.n1+" "+d.n2+(n?' is keen to <span class="tag-green">#'+n+"</span>.":" posted a new activity.");break;case ktGlobals.NOTIF_ACTIVITY_CONFIRM:k=(n?'<span class="tag-green">#'+n+"</span>":"An activity")+" with "+d.n1+" has been confirmed!";break;case ktGlobals.NOTIF_ACTIVITY_UPDATE:k=(n?'<span class="tag-green">#'+n+"</span>":"An activity")+" with "+d.n1+" details updated.";break;case ktGlobals.NOTIF_ACTIVITY_CANCEL:k=(n?'<span class="tag-green">#'+n+"</span>":"An activity")+" with "+d.n1+" was cancelled.";break;case ktGlobals.NOTIF_ACTIVITY_KEEN:k="New keener on "+(n?'<span class="tag-green">#'+n+"</span>.":"your post.");break;case ktGlobals.NOTIF_ACTIVITY_COMMENT:k="New comment on "+(n?'<span class="tag-green">#'+n+"</span>.":"your post.");break;case ktGlobals.NOTIF_REMINDER:var a=new Date(),c=a+1800000,m;if(e){m=e.get("details");if(m){c=m.when}}k=(n?'<span class="tag-green">#'+n+"</span>":"An activity")+" with "+d.n1+" coming up at "+ktGlobals.timeInWords(confirmation.when)+".";default:return""}return'<div class="message"><div class="pic-col">'+f+'</div><div class="info-col">'+k+"</div></div>"},profileImgHtml:function(b,a){return"<img style=\"background-image:url('http://graph.facebook.com/"+b+'/picture\');" width="'+a+'" height="'+a+'" src="resources/images/img-mask'+a+'.png"/>'},interestLabelHtml:function(a){var b='<div class="lbl-interest">';b+='<span class="tag-green">#'+a.tag+"</span>, ";b+="</div>";return b},mutualsHtml:function(a){if(!a){return"no mutual friends"}return a+(a>1?" mutual friends":" mutual friend")},followersHtml:function(a){if(!a){return"no followers yet"}return a+(a>1?" followers":" follower")},keenersHtml:function(b,a){if(b){return b+(b>1?" keeners":" keener")}else{return a||"no keeners yet"}},keenersHeadingHtml:function(a){return'<div class="subtitle no-top">'+a+(a==1?" keen":" keens")+"</div>"},tagHtml:function(a,b){switch(a){case"cn":return'<div class="tag-confirmed">it\'s on!</div>';break;case"cr":return'<div class="tag-confirmed">my post</div>';break;case"kn":return'<div class="tag-keeners">'+b+" new keener"+(b>1?"s":"")+"</div>";break;case"cm":return'<div class="tag-comments">'+b+" new comment"+(b>1?"s":"")+"</div>";break;default:return""}},landingBgHtml:function(){return'<div id="landing-bg">'+ktGlobals.landingBgInnerHtml();+"</div>"},landingBgInnerHtml:function(a){return'<div id="landing-logo"></div>			<div id="landing-spin" class="landing-spin"></div>			<div id="landing-text" class="landing-text blink">'+(a||"loading")+"</div>"},getActivityInviteUrl:function(a,b,c){return"http://keen.to/"+a+"-with-"+b+"-"+c},getConnectionInviteUrl:function(){return},getInviteMessage:function(h,b){var j="",c=Keen.app.profileData.firstName,e,f;if(messageParts){for(e=0;e<messageParts.length;e++){j+=messageParts[e]}j+=" - Join me on the link below."}else{var d=Keen.app.profileData.interests,g=Keen.app.profileData.uHash;if(myInterests&&myInterests.length){var a=myInterests[0];for(e=1,f=Math.min(myInterests.length,3);e<f;e++){a+=", "+myInterests[e]}myInterests=a}else{myInterests=false}j+="Hey "+(inviteeName?inviteeName:"guys")+",\n\nCome check out KEEN - it's a new phone app for sharing or finding things that you're keen to do.\n\n";j+="Great way to stay in touch with real friends, or finding others to join you for something you want to do.\n\nMaybe we can hang out more?"+(myInterests?" (I'm always keen for "+myInterests+")":"")+"\n\nCome join me on the link below :)\nhttp://keen.to/join."+c+"."+g}return j},contactToString:function(a){var b,d,e,c;b=a.p;if(b&&b.length){d=b[0];e=d.type+"-"+d.value;for(c=1,numbersLn=b.length;c<numbersLn;c++){d=b[c];e+="."+d.type+"-"+d.value}}return a.id+"_"+a.n1+"."+a.n2+(e?("_"+e):"")},setCaretPosition:function(b,c){var a=b.getComponent().element.getFirstChild().dom;if(c<0){c=b.getValue().length}if(a.setSelectionRange){a.setSelectionRange(c,c)}else{if(a.createTextRange){range=a.createTextRange();range.move("character",c);range.select()}}b.focus()}};